<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarboCheck - Test API Real</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .title { font-size: 2em; color: #2c3e50; margin-bottom: 20px; text-align: center; }
        .btn { background: #3498db; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin: 10px; }
        .btn:hover { background: #2980b9; }
        .results { background: #2c3e50; color: white; padding: 20px; border-radius: 10px; margin-top: 20px; }
        .data-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .data-value { font-size: 1.2em; font-weight: bold; color: #3498db; }
        .classification { text-align: center; margin: 20px 0; padding: 15px; border-radius: 10px; font-weight: bold; }
        .classification.low { background: #27ae60; }
        .classification.medium { background: #f39c12; }
        .classification.high { background: #e74c3c; }
        .json-output { background: #34495e; color: #ecf0f1; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; margin-top: 15px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1 class="title">üì± CarboCheck - Test API</h1>
            
            <div style="text-align: center;">
                <button class="btn" onclick="testBanana()">üçå Test Banana</button>
                <button class="btn" onclick="testApple()">üçé Test Manzana</button>
                <button class="btn" onclick="testBread()">üçû Test Pan</button>
            </div>

            <div id="results" class="results" style="display: none;">
                <h3 id="foodName">Resultado del Escaneo</h3>
                <p style="opacity: 0.8; margin-bottom: 15px;">Datos por 100 gramos</p>
                
                <div class="data-item">
                    <span>Carbohidratos:</span>
                    <span class="data-value" id="carbs">0g</span>
                </div>
                <div class="data-item">
                    <span>Az√∫cares:</span>
                    <span class="data-value" id="sugars">0g</span>
                </div>
                <div class="data-item">
                    <span>Calor√≠as:</span>
                    <span class="data-value" id="calories">0</span>
                </div>
                <div class="data-item">
                    <span>√çndice Gluc√©mico:</span>
                    <span class="data-value" id="gi">0</span>
                </div>
                
                <div id="classification" class="classification">
                    <span id="classificationText">Clasificaci√≥n IG</span>
                </div>

                <div class="json-output" id="jsonOutput" style="display: none;">
                    Respuesta JSON de la API...
                </div>
            </div>
        </div>
    </div>

    <script>
        async function testBanana() {
            const mockResponse = {
                foodName: "Banana",
                carbohydrates: 23.0,
                sugars: 12.2,
                calories: 89,
                glycemicIndex: 51,
                glycemicClassification: {
                    level: "Medio",
                    color: "yellow",
                    emoji: "üü°",
                    recommendation: "Consumo moderado"
                },
                portion: "100g",
                confidence: 0.94,
                timestamp: Date.now()
            };
            
            displayResults(mockResponse);
        }

        async function testApple() {
            const mockResponse = {
                foodName: "Manzana",
                carbohydrates: 14.0,
                sugars: 10.4,
                calories: 52,
                glycemicIndex: 36,
                glycemicClassification: {
                    level: "Bajo",
                    color: "green",
                    emoji: "üü¢",
                    recommendation: "Ideal para diab√©ticos"
                },
                portion: "100g",
                confidence: 0.96,
                timestamp: Date.now()
            };
            
            displayResults(mockResponse);
        }

        async function testBread() {
            const mockResponse = {
                foodName: "Pan Blanco",
                carbohydrates: 49.0,
                sugars: 5.0,
                calories: 265,
                glycemicIndex: 75,
                glycemicClassification: {
                    level: "Alto",
                    color: "red",
                    emoji: "üî¥",
                    recommendation: "Precauci√≥n"
                },
                portion: "100g",
                confidence: 0.91,
                timestamp: Date.now()
            };
            
            displayResults(mockResponse);
        }

        function displayResults(data) {
            document.getElementById('results').style.display = 'block';
            
            // Mostrar datos principales
            document.getElementById('foodName').textContent = `${data.glycemicClassification.emoji} ${data.foodName}`;
            document.getElementById('carbs').textContent = `${data.carbohydrates}g`;
            document.getElementById('sugars').textContent = `${data.sugars}g`;
            document.getElementById('calories').textContent = data.calories;
            document.getElementById('gi').textContent = data.glycemicIndex;
            
            // Mostrar clasificaci√≥n con riesgo
            const classification = document.getElementById('classification');
            const classText = document.getElementById('classificationText');
            
            // Determinar nivel de riesgo
            let riskLevel = "";
            if (data.glycemicIndex <= 55) {
                riskLevel = "RIESGO BAJO - Seguro para diab√©ticos";
            } else if (data.glycemicIndex <= 70) {
                riskLevel = "RIESGO MODERADO - Consumir con precauci√≥n";
            } else {
                riskLevel = "RIESGO ALTO - Evitar o consumir muy poco";
            }
            
            classText.textContent = `${data.glycemicClassification.emoji} ${riskLevel}`;
            classification.className = `classification ${data.glycemicClassification.color}`;
            
            // Mostrar JSON simplificado (sin mostrar el JSON completo)
            const simplifiedData = {
                alimento: data.foodName,
                carbohidratos: `${data.carbohydrates}g`,
                azucares: `${data.sugars}g`,
                calorias: data.calories,
                indiceGlucemico: data.glycemicIndex,
                nivelRiesgo: riskLevel,
                recomendacion: data.glycemicClassification.recommendation
            };
            
            document.getElementById('jsonOutput').textContent = JSON.stringify(simplifiedData, null, 2);
        }

        // Simular llamada real a la API
        async function callRealAPI(imageFile) {
            const formData = new FormData();
            formData.append('image', imageFile);
            
            try {
                const response = await fetch('http://localhost:8080/api/food/scan', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                displayResults(data);
            } catch (error) {
                console.error('Error calling API:', error);
                alert('Error: Aseg√∫rate de que el backend est√© ejecut√°ndose en puerto 8080');
            }
        }
    </script>
</body>
</html>
